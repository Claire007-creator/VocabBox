<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VocaBox - Flashcard Learning App</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-layout">
                <div class="header-left">
                    <img src="logo.png" alt="VocaBox Logo" class="app-logo">
                </div>
                <div class="header-center">
                    <img src="title.png" alt="VocaBox" class="app-title-image">
                </div>
                <div class="header-right">
                    <div class="premium-chip">
                        <button class="premium-btn" id="premiumAccessBtn" type="button">Premium</button>
                        <span class="premium-status-badge" id="premiumStatusBadge" hidden>Unlocked</span>
                    </div>
                    <div id="authButtons">
                    <button class="auth-btn subscription-btn" id="subscriptionBtn">Subscription</button>
                    <button class="auth-btn sign-in-btn">Sign In</button>
                    <button class="auth-btn sign-up-btn">Sign Up</button>
                    </div>
                    <div id="userInfo" style="display: none; align-items: center; gap: 10px; flex-wrap: wrap;">
                        <span class="user-welcome">Welcome, <span id="usernameDisplay"></span>!</span>
                        <span id="subscriptionBadge" class="subscription-badge" style="padding: 4px 12px; border-radius: 12px; font-size: 0.85rem; font-weight: bold; background: #e0e0e0; color: #666;"></span>
                        <button class="auth-btn" id="manageSubscriptionBtn" style="padding: 6px 12px; font-size: 0.85rem;">Manage Plan</button>
                        <button class="auth-btn sign-out-btn">Sign Out</button>
                    </div>
                </div>
            </div>
            <p class="app-subtitle">Memorize in a Fl!p.</p>
        </header>

        <!-- Home Screen -->
        <main class="home-screen" id="homeScreen" data-screen="home">
            <div class="home-hero">
                <div class="home-hero-text">
                    <p class="home-eyebrow">Choose your focus</p>
                    <h1 class="home-title">What do you want to practice today?</h1>
                    <p class="home-subtitle"></p>
                </div>
                <div class="home-hero-art" aria-hidden="true">
                    <img src="cards.png" alt="" />
                </div>
            </div>
            <div class="category-grid">
                <button class="category-card" type="button" data-screen-target="words">
                    <div class="category-icon">
                        <img src="card.png" alt="" />
                    </div>
                    <div class="category-label">Words</div>
                    <p class="category-copy"></p>
                </button>
                <button class="category-card" type="button" data-screen-target="sentences">
                    <div class="category-icon">
                        <img src="writing.png" alt="" />
                    </div>
                    <div class="category-label">Sentences</div>
                    <p class="category-copy"></p>
                </button>
                <button class="category-card" type="button" data-screen-target="grammar">
                    <div class="category-icon">
                        <img src="pencil.png" alt="" />
                    </div>
                    <div class="category-label">Grammar</div>
                    <p class="category-copy"></p>
                </button>
                <button class="category-card" type="button" data-screen-target="listening">
                    <div class="category-icon">
                        <img src="music.png" alt="" />
                    </div>
                    <div class="category-label">Listening</div>
                    <p class="category-copy"></p>
                </button>
                <button class="category-card" type="button" data-screen-target="reading">
                    <div class="category-icon">
                        <img src="books.png" alt="" />
                    </div>
                    <div class="category-label">Reading</div>
                    <p class="category-copy"></p>
                </button>
            </div>
        </main>

        <!-- Words Category Screen -->
        <main class="main-content category-screen" id="WordsScreen" data-screen="words" hidden>
            <div class="category-screen-header">
                <div>
                    <p class="category-screen-eyebrow">Learning category</p>
                    <h2 class="category-screen-title">Words</h2>
                    <p class="category-screen-subtitle"></p>
                </div>
                <button class="btn btn-secondary btn-small back-to-home-btn" type="button" data-screen-target="home">
                    ‚Üê Back to Home Page
                </button>
            </div>
            <section class="pack-section" data-pack-section="words">
                <div class="pack-section-header">
                    <h3 class="pack-section-title">Word packs</h3>
                    <p class="pack-section-subtitle">Choose a collection to review vocabulary lists by exam or theme.</p>
                </div>
                <div class="pack-grid"></div>
            </section>

            <!-- Shared Deck Workspace (Words + Sentences) -->
            <div id="deckWorkspaceRoot">
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn btn-primary" id="addCardBtn">
                        <span class="btn-icon">
                            <img src="cards.png" alt="Add" class="btn-icon-image">
                        </span>
                        Add Card
                    </button>
                    <button class="btn btn-import" id="importWordListBtn">
                        <span class="btn-icon">
                            <img src="plus.png" alt="Import" class="btn-icon-image">
                        </span>
                        +Import
                    </button>
                </div>

                <!-- Single Column Layout -->
                <div class="single-column-layout">
                    <!-- Folder Management -->
                    <div class="folder-section">
                        <div class="folder-header">
                            <h3 class="folder-title">Folders</h3>
                            <button class="btn btn-folder" id="createFolderBtn">
                                <span class="btn-icon">
                                    <img src="plus.png" alt="Add" class="btn-icon-image">
                                </span>
                                New Folder
                            </button>
                        </div>
                        <div class="folder-list" id="folderList">
                            <!-- Folders will be dynamically inserted here -->
                        </div>
                    </div>

                    <!-- Cards Column -->
                    <div class="column">
                        <div class="cards-header">
                            <div class="cards-header-left">
                                <div class="current-folder-info" id="currentFolderInfo">
                                    <span class="folder-info-content" id="currentFolderContent">All Folders-0 cards</span>
                                </div>
                            </div>
                            <div class="folder-selector">
                                <select id="listDropdown" class="folder-dropdown" style="display: none;">
                                    <option value="">All Lists</option>
                                </select>
                            </div>
                        </div>
                        <div class="cards-container" id="cardsContainer">
                            <!-- Cards will be dynamically inserted here -->
                            <button class="card-arrow card-arrow-left" id="mainCardArrowLeft" aria-label="Previous card">‚Üê</button>
                            <button class="card-arrow card-arrow-right" id="mainCardArrowRight" aria-label="Next card">‚Üí</button>
                        </div>
                        <!-- Navigation Controls -->
                        <div class="cards-navigation" id="cardsNavigation" style="display: none;">
                            <span class="card-position" id="cardPosition">1 / 0</span>
                            <div class="card-practice-row" id="wordPracticeLauncher" hidden>
                                <div class="practice-scope-selector" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px; justify-content: center;">
                                    <label for="practiceScopeSelect" style="font-size: 0.9rem; color: #666; font-weight: 500;">Scope:</label>
                                    <select id="practiceScopeSelect" style="padding: 6px 12px; border-radius: 6px; border: 1px solid #ddd; font-size: 0.9rem; background: white; cursor: pointer;">
                                        <option value="list">Current list only</option>
                                        <option value="folder">Whole folder</option>
                                    </select>
                                </div>
                                <button class="practice-launch-btn" type="button" id="typingPracticeBtn" aria-label="Start typing practice">
                                    Typing
                                </button>
                                <button class="practice-launch-btn" type="button" id="multipleChoicePracticeBtn" aria-label="Start multiple choice practice">
                                    Multiple Choice
                                </button>
                            </div>
                        </div>
                        <div class="empty-state" id="cardsEmptyState">
                            <div class="empty-icon">
                                <img src="books.png" alt="Books" class="empty-state-image">
                            </div>
                            <h4>No cards yet!</h4>
                            <p>Click "Add Card" to create flashcards</p>
                        </div>
                        <!-- Cat image that shows even when cards exist -->
                        <div class="cat-decoration">
                            <img src="books.png" alt="Books" class="cat-decoration-image">
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <!-- Sentences Screen -->
        <section class="category-screen" id="SentencesScreen" data-screen="sentences" hidden>
            <div class="category-screen-header">
                <div>
                    <h2 class="category-screen-title">Sentences</h2>
                    <!-- Subtitle removed per UX request -->
                </div>
                <button class="btn btn-secondary btn-small back-to-home-btn" type="button" data-screen-target="home">
                    ‚Üê Back to Home Page
                </button>
            </div>
            <section class="pack-section" data-pack-section="sentences">
                <div class="pack-section-header">
                    <h3 class="pack-section-title">Sentence packs</h3>
                </div>
                <div class="pack-grid"></div>
            </section>
        </section>

        <!-- Grammar Screen -->
        <section class="category-screen" id="GrammarScreen" data-screen="grammar" hidden>
            <div class="category-screen-header">
                <div>
                    <p class="category-screen-eyebrow">Learning category</p>
                    <h2 class="category-screen-title">Grammar</h2>
                    <p class="category-screen-subtitle">Understand structure with focused grammar packs.</p>
                </div>
                <button class="btn btn-secondary btn-small back-to-home-btn" type="button" data-screen-target="home">
                    ‚Üê Back to Home Page
                </button>
            </div>
            <section class="pack-section" data-pack-section="grammar">
                <div class="pack-section-header">
                    <h3 class="pack-section-title">Grammar packs</h3>
                    <p class="pack-section-subtitle">Select a topic to prepare exercises and explanations.</p>
                </div>
                <div class="pack-grid"></div>
            </section>
        </section>

        <!-- Listening Screen -->
        <section class="category-screen" id="ListeningScreen" data-screen="listening" hidden>
            <div class="category-screen-header">
                <div>
                    <p class="category-screen-eyebrow">Learning category</p>
                    <h2 class="category-screen-title">Listening</h2>
                    <p class="category-screen-subtitle">Train your ear with guided audio packs.</p>
                </div>
                <button class="btn btn-secondary btn-small back-to-home-btn" type="button" data-screen-target="home">
                    ‚Üê Back to Home Page
                </button>
            </div>
            <section class="pack-section" data-pack-section="listening">
                <div class="pack-section-header">
                    <h3 class="pack-section-title">Listening packs</h3>
                    <p class="pack-section-subtitle">Pick an audio set to warm up comprehension.</p>
                </div>
                <div class="pack-grid"></div>
            </section>
        </section>

        <!-- Reading Screen -->
        <section class="category-screen" id="ReadingScreen" data-screen="reading" hidden>
            <div class="category-screen-header">
                <div>
                    <p class="category-screen-eyebrow">Learning category</p>
                    <h2 class="category-screen-title">Reading</h2>
                    <p class="category-screen-subtitle">Dive into passages, notes, and guided reading plans.</p>
                </div>
                <button class="btn btn-secondary btn-small back-to-home-btn" type="button" data-screen-target="home">
                    ‚Üê Back to Home Page
                </button>
            </div>
            <section class="pack-section" data-pack-section="reading">
                <div class="pack-section-header">
                    <h3 class="pack-section-title">Reading packs</h3>
                    <p class="pack-section-subtitle">Choose curated reading materials to improve comprehension.</p>
                </div>
                <div class="pack-grid"></div>
            </section>
        </section>

        <!-- Pack Detail Screen -->
        <section class="category-screen pack-detail-screen" id="PackDetailScreen" data-screen="pack-detail" hidden>
            <div class="category-screen-header">
                <div>
                    <p class="category-screen-eyebrow">Pack detail</p>
                    <h2 class="category-screen-title" id="packDetailTitle">Pack Title</h2>
                    <p class="category-screen-subtitle" id="packDetailCategory">Category ¬∑ Pack</p>
                </div>
                <button class="btn btn-secondary btn-small back-to-home-btn" type="button" data-pack-back-btn data-screen-target="home">
                    ‚Üê Back to Home Page
                </button>
            </div>
            <div class="pack-detail-content">
                <div class="pack-detail-card">
                    <p class="pack-detail-description" id="packDetailDescription">Select a pack to view more information.</p>
                    <div class="pack-detail-behavior">
                        <p class="pack-detail-behavior-label">Behavior</p>
                        <p class="pack-detail-behavior-value" id="packDetailBehavior">Choose a pack to see how this category behaves.</p>
                    </div>
                    <div class="pack-detail-study-modes">
                        <div class="pack-detail-study-modes-header">
                            <h3>Available study modes</h3>
                            <p>Pick a mode to jump into learning. Ready modes are live, Soon modes are on the way.</p>
                        </div>
                        <div class="study-mode-legend">
                            <div>
                                <span class="study-mode-ready">Ready</span>
                                <span class="study-mode-legend-text">Available now</span>
                            </div>
                            <div>
                                <span class="study-mode-coming">Soon</span>
                                <span class="study-mode-legend-text">In development</span>
                            </div>
                        </div>
                        <div class="study-mode-grid" id="packDetailStudyModes"></div>
                    </div>
                    <div class="pack-detail-placeholder">
                        <p class="pack-detail-note" id="packDetailPlaceholder">This is the placeholder view for the selected pack. Study modes will be added later.</p>
                        <p class="pack-detail-todo" id="packDetailTodo">// TODO: Add Flash, Typing, Listening, and Reading modes for this pack.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Study Mode Screen -->
        <section class="category-screen study-mode-screen" id="StudyModeScreen" data-screen="study-mode" hidden>
            <div class="category-screen-header">
                <div>
                    <p class="category-screen-eyebrow">Study mode</p>
                    <h2 class="category-screen-title" id="studyModeTitle">Flash Mode</h2>
                    <p class="category-screen-subtitle" id="studyModeSubtitle">Words ¬∑ CET-4 Word Book</p>
                </div>
                <div class="study-mode-header-actions">
                    <button class="btn btn-secondary btn-small" type="button" id="studyModeBackBtn" data-study-back-btn data-screen-target="pack-detail">
                        ‚Üê Back to Pack
                    </button>
                </div>
            </div>
            <div class="study-mode-content">
                <div class="study-mode-card">
                    <div id="studyModePlaceholder">
                        <p id="studyModeDescription">This is a placeholder study mode view. We will plug in the real experience soon.</p>
                        <div class="study-mode-meta">
                            <p><strong>Behavior:</strong> <span id="studyModeBehavior">Auto-spaced repetition</span></p>
                            <p><strong>Card Type:</strong> <span id="studyModeCardType">WordCard</span></p>
                        </div>
                    </div>
                    <div class="reading-highlight-session" id="readingHighlightSession" hidden>
                        <div class="reading-highlight-header">
                            <div>
                                <p class="reading-highlight-eyebrow">Reading passage</p>
                                <h3 class="reading-highlight-title" id="readingHighlightTitle">Passage title</h3>
                                <p class="reading-highlight-summary" id="readingHighlightSummary"></p>
                            </div>
                            <div class="reading-highlight-controls">
                                <span class="reading-highlight-counter" id="readingHighlightCounter">Passage 1 of 1</span>
                                <div class="reading-highlight-nav">
                                    <button class="btn btn-secondary btn-small" id="readingHighlightPrev">‚Üê Previous</button>
                                    <button class="btn btn-secondary btn-small" id="readingHighlightNext">Next ‚Üí</button>
                                </div>
                            </div>
                        </div>
                        <div class="reading-highlight-text" id="readingHighlightText"></div>
                        <div class="reading-highlight-selected">
                            <div>
                                <p class="reading-highlight-selected-title">
                                    Selected words <span id="readingHighlightSelectionCount">(0)</span>
                                </p>
                                <ul class="reading-highlight-selection-list" id="readingHighlightSelections"></ul>
                            </div>
                            <button class="btn btn-primary btn-small" id="readingHighlightSave">Save Highlights</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- Collections Modal -->
    <div class="modal" id="collectionsModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2><img src="books.png" alt="Collections" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Word Collections</h2>
                <button class="close-btn" id="closeCollectionsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="collections-list" id="collectionsList">
                    <div class="collection-card" data-collection-id="ielts8000">
                        <div class="collection-icon"><img src="books.png" alt="IELTS" style="width: 60px; height: 60px;"></div>
                        <div class="collection-info">
                            <h3>IELTS 8000 <span style="color: #5FB3A7; font-size: 0.8rem; font-weight: 600;">‚úì Built-in</span></h3>
                            <p>8,000-word set automatically loaded. Creates 40 lists (200 words each). Already available in your folders!</p>
                            <div class="collection-actions">
                                <button class="btn btn-secondary" id="importIELTSBtn">Reload/Re-import</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="collectionsError" class="error-message" style="display: none;"></div>
            </div>
        </div>
    </div>


    <!-- Create Folder Modal -->
    <div class="modal" id="createFolderModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2><img src="test.png" alt="Folder" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Create New Folder</h2>
                <button class="close-btn" id="closeCreateFolderBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createFolderForm">
                    <div class="form-group">
                        <label for="folderName">Folder Name</label>
                        <input type="text" id="folderName" class="form-input" placeholder="Enter folder name" required>
                    </div>
                    <div class="form-group">
                        <label for="folderDescription">Description (Optional)</label>
                        <textarea id="folderDescription" class="form-textarea" placeholder="Enter folder description" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelCreateFolderBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create Folder</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create List Modal -->
    <div class="modal" id="createListModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2><img src="test.png" alt="List" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Create New List</h2>
                <button class="close-btn" id="closeCreateListBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createListForm">
                    <div class="form-group">
                        <label for="listParentFolder">Parent Folder</label>
                        <select id="listParentFolder" class="form-select" required>
                            <option value="">Select a parent folder</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="listName">List Name</label>
                        <input type="text" id="listName" class="form-input" placeholder="Enter list name" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelCreateListBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create List</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Card Modal -->
    <div class="modal" id="addCardModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Add New Card</h2>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addCardForm">
                    <div class="add-card-layout">
                        <!-- Left Column - Content Areas -->
                        <div class="add-card-content-column">
                            <div class="form-group">
                                <label for="addFrontText">Front (Word/Question)</label>
                                <div class="editor-toolbar">
                                    <button type="button" class="toolbar-btn" data-command="bold" data-target="addfront" title="Bold">
                                        <strong>B</strong>
                                    </button>
                                    <button type="button" class="toolbar-btn" data-command="underline" data-target="addfront" title="Underline">
                                        <u>U</u>
                                    </button>
                                    <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertUnorderedList" data-target="addfront" title="Bullet List">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                            <circle cx="3" cy="5" r="1.5"/>
                                            <rect x="7" y="4" width="10" height="2" rx="1"/>
                                            <circle cx="3" cy="10" r="1.5"/>
                                            <rect x="7" y="9" width="10" height="2" rx="1"/>
                                            <circle cx="3" cy="15" r="1.5"/>
                                            <rect x="7" y="14" width="10" height="2" rx="1"/>
                                        </svg>
                                    </button>
                                    <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertOrderedList" data-target="addfront" title="Numbered List">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                            <text x="1" y="7" font-size="8" font-weight="bold">1.</text>
                                            <rect x="7" y="4" width="10" height="2" rx="1"/>
                                            <text x="1" y="12" font-size="8" font-weight="bold">2.</text>
                                            <rect x="7" y="9" width="10" height="2" rx="1"/>
                                            <text x="1" y="17" font-size="8" font-weight="bold">3.</text>
                                            <rect x="7" y="14" width="10" height="2" rx="1"/>
                                        </svg>
                                    </button>
                                    <button type="button" class="toolbar-btn" data-command="highlightHide" data-target="addfront" title="Highlight to Hide">
                                        <span style="background: #ffeb3b; padding: 2px 4px; border-radius: 2px; font-size: 10px;">HIDE</span>
                                    </button>
                                    <button type="button" class="toolbar-btn color-btn color-picker-btn" data-target="addfront" title="Custom Color">
                                        <span class="color-indicator-picker">üé®</span>
                                    </button>
                                    <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="addfront" data-preset="1" data-color="#457B9D" title="Preset Color 1 (Right-click to customize)">
                                        <span class="color-indicator preset-1-addfront" style="background-color: #457B9D;"></span>
                                    </button>
                                    <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="addfront" data-preset="2" data-color="#9E2A2B" title="Preset Color 2 (Right-click to customize)">
                                        <span class="color-indicator preset-2-addfront" style="background-color: #9E2A2B;"></span>
                                    </button>
                                    <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="addfront" data-preset="3" data-color="#4D908E" title="Preset Color 3 (Right-click to customize)">
                                        <span class="color-indicator preset-3-addfront" style="background-color: #4D908E;"></span>
                                    </button>
                                    <input type="color" class="color-picker-hidden" id="colorPickerAddFront" data-target="addfront" value="#000000">
                                </div>
                                <div id="addFrontText" class="rich-editor rich-editor-large" contenteditable="true" placeholder="Enter word or question..."></div>
                            </div>
                            <div class="form-group">
                                <label for="addBackText">Back (Definition/Answer)</label>
                                <div class="editor-toolbar">
                                    <button type="button" class="toolbar-btn" data-command="bold" data-target="addback" title="Bold">
                                        <strong>B</strong>
                                    </button>
                                    <button type="button" class="toolbar-btn" data-command="underline" data-target="addback" title="Underline">
                                        <u>U</u>
                                    </button>
                                    <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertUnorderedList" data-target="addback" title="Bullet List">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                            <circle cx="3" cy="5" r="1.5"/>
                                            <rect x="7" y="4" width="10" height="2" rx="1"/>
                                            <circle cx="3" cy="10" r="1.5"/>
                                            <rect x="7" y="9" width="10" height="2" rx="1"/>
                                            <circle cx="3" cy="15" r="1.5"/>
                                            <rect x="7" y="14" width="10" height="2" rx="1"/>
                                        </svg>
                                    </button>
                                    <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertOrderedList" data-target="addback" title="Numbered List">
                                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                            <text x="1" y="7" font-size="8" font-weight="bold">1.</text>
                                            <rect x="7" y="4" width="10" height="2" rx="1"/>
                                            <text x="1" y="12" font-size="8" font-weight="bold">2.</text>
                                            <rect x="7" y="9" width="10" height="2" rx="1"/>
                                            <text x="1" y="17" font-size="8" font-weight="bold">3.</text>
                                            <rect x="7" y="14" width="10" height="2" rx="1"/>
                                        </svg>
                                    </button>
                                    <button type="button" class="toolbar-btn" data-command="highlightHide" data-target="addback" title="Highlight to Hide">
                                        <span style="background: #ffeb3b; padding: 2px 4px; border-radius: 2px; font-size: 10px;">HIDE</span>
                                    </button>
                                    <button type="button" class="toolbar-btn color-btn color-picker-btn" data-target="addback" title="Custom Color">
                                        <span class="color-indicator-picker">üé®</span>
                                    </button>
                                    <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="addback" data-preset="1" data-color="#457B9D" title="Preset Color 1 (Right-click to customize)">
                                        <span class="color-indicator preset-1-addback" style="background-color: #457B9D;"></span>
                                    </button>
                                    <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="addback" data-preset="2" data-color="#9E2A2B" title="Preset Color 2 (Right-click to customize)">
                                        <span class="color-indicator preset-2-addback" style="background-color: #9E2A2B;"></span>
                                    </button>
                                    <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="addback" data-preset="3" data-color="#4D908E" title="Preset Color 3 (Right-click to customize)">
                                        <span class="color-indicator preset-3-addback" style="background-color: #4D908E;"></span>
                                    </button>
                                    <input type="color" class="color-picker-hidden" id="colorPickerAddBack" data-target="addback" value="#000000">
                                </div>
                                <div id="addBackText" class="rich-editor rich-editor-large" contenteditable="true" placeholder="Enter definition or answer..."></div>
                            </div>
                        </div>
                        
                        <!-- Right Column - Controls -->
                        <div class="add-card-controls-column">
                            <div class="form-group">
                                <label for="addCardFolder">Folder</label>
                                <div class="folder-selector-group">
                                    <select id="addCardFolder" class="form-select">
                                        <option value="default">Default Folder</option>
                                    </select>
                                    <button type="button" class="btn btn-secondary btn-small" id="createFolderForAddCardBtn">
                                        <img src="plus.png" alt="Add" style="width: 12px; height: 12px; vertical-align: middle; margin-right: 4px;"> Folder
                                    </button>
                                </div>
                            </div>
                            <div class="form-group" id="addCardListGroup" style="display: none;">
                                <label for="addCardList">List (Optional)</label>
                                <div class="folder-selector-group">
                                    <select id="addCardList" class="form-select">
                                        <option value="">No List (Save to Folder)</option>
                                    </select>
                                    <button type="button" class="btn btn-secondary btn-small" id="createListForAddCardBtn">
                                        <img src="plus.png" alt="Add" style="width: 12px; height: 12px; vertical-align: middle; margin-right: 4px;"> List
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Audio (Optional)</label>
                                <div class="audio-section">
                                    <div id="addCurrentAudio" class="current-audio" style="display: none;">
                                        <div class="audio-player-container">
                                            <audio id="addAudioPlayer" controls></audio>
                                            <button type="button" class="btn-icon-small btn-danger-small" id="addRemoveAudioBtn" title="Remove Audio">
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                    <div id="addAudioUploadSection" class="audio-upload-section">
                                        <input type="file" id="addAudioFileInput" accept="audio/*" style="display: none;">
                                        <button type="button" class="btn btn-upload" id="addUploadAudioBtn">
                                            <img src="music.png" alt="Upload" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;">
                                            Upload Audio File
                                        </button>
                                        <small class="input-hint">Supported: MP3, WAV, M4A, OGG (Max 10MB)</small>
                                    </div>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn btn-warning btn-large" id="addNextCardBtn">Next Card</button>
                                <button type="submit" class="btn btn-success btn-large" id="finishBtn">Finish</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Card Modal -->
    <div class="modal" id="editCardModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <button class="nav-card-btn" id="editPrevCardBtn" title="Previous Card">‚Üê</button>
                <h2>Edit Card <span id="editCardNum"></span></h2>
                <button class="nav-card-btn" id="editNextCardBtn" title="Next Card">‚Üí</button>
                <button class="close-btn" id="closeEditModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="editCardForm">
                    <div class="form-group">
                        <label for="editFrontText">Front (Word/Question)</label>
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn" data-command="bold" data-target="front" title="Bold">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="underline" data-target="front" title="Underline">
                                <u>U</u>
                            </button>
                            <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertUnorderedList" data-target="front" title="Bullet List">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <circle cx="3" cy="5" r="1.5"/>
                                    <rect x="7" y="4" width="10" height="2" rx="1"/>
                                    <circle cx="3" cy="10" r="1.5"/>
                                    <rect x="7" y="9" width="10" height="2" rx="1"/>
                                    <circle cx="3" cy="15" r="1.5"/>
                                    <rect x="7" y="14" width="10" height="2" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertOrderedList" data-target="front" title="Numbered List">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <text x="1" y="7" font-size="8" font-weight="bold">1.</text>
                                    <rect x="7" y="4" width="10" height="2" rx="1"/>
                                    <text x="1" y="12" font-size="8" font-weight="bold">2.</text>
                                    <rect x="7" y="9" width="10" height="2" rx="1"/>
                                    <text x="1" y="17" font-size="8" font-weight="bold">3.</text>
                                    <rect x="7" y="14" width="10" height="2" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="highlightHide" data-target="front" title="Highlight to Hide">
                                <span style="background: #ffeb3b; padding: 2px 4px; border-radius: 2px; font-size: 10px;">HIDE</span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn color-picker-btn" data-target="front" title="Custom Color">
                                <span class="color-indicator-picker">üé®</span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="front" data-preset="1" data-color="#457B9D" title="Preset Color 1 (Right-click to customize)">
                                <span class="color-indicator preset-1-front" style="background-color: #457B9D;"></span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="front" data-preset="2" data-color="#9E2A2B" title="Preset Color 2 (Right-click to customize)">
                                <span class="color-indicator preset-2-front" style="background-color: #9E2A2B;"></span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="front" data-preset="3" data-color="#4D908E" title="Preset Color 3 (Right-click to customize)">
                                <span class="color-indicator preset-3-front" style="background-color: #4D908E;"></span>
                            </button>
                            <input type="color" class="color-picker-hidden" id="colorPickerFront" data-target="front" value="#000000">
                            <input type="color" class="color-picker-hidden" id="customColorPicker1Front" data-preset="1" data-target="front" value="#457B9D">
                            <input type="color" class="color-picker-hidden" id="customColorPicker2Front" data-preset="2" data-target="front" value="#9E2A2B">
                            <input type="color" class="color-picker-hidden" id="customColorPicker3Front" data-preset="3" data-target="front" value="#4D908E">
                        </div>
                        <div id="editFrontText" class="rich-editor" contenteditable="true" placeholder="Enter word or question..."></div>
                    </div>
                    <div class="form-group">
                        <label for="editBackText">Back (Definition/Answer)</label>
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn" data-command="bold" data-target="back" title="Bold">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="underline" data-target="back" title="Underline">
                                <u>U</u>
                            </button>
                            <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertUnorderedList" data-target="back" title="Bullet List">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <circle cx="3" cy="5" r="1.5"/>
                                    <rect x="7" y="4" width="10" height="2" rx="1"/>
                                    <circle cx="3" cy="10" r="1.5"/>
                                    <rect x="7" y="9" width="10" height="2" rx="1"/>
                                    <circle cx="3" cy="15" r="1.5"/>
                                    <rect x="7" y="14" width="10" height="2" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertOrderedList" data-target="back" title="Numbered List">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <text x="1" y="7" font-size="8" font-weight="bold">1.</text>
                                    <rect x="7" y="4" width="10" height="2" rx="1"/>
                                    <text x="1" y="12" font-size="8" font-weight="bold">2.</text>
                                    <rect x="7" y="9" width="10" height="2" rx="1"/>
                                    <text x="1" y="17" font-size="8" font-weight="bold">3.</text>
                                    <rect x="7" y="14" width="10" height="2" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="highlightHide" data-target="back" title="Highlight to Hide">
                                <span style="background: #ffeb3b; padding: 2px 4px; border-radius: 2px; font-size: 10px;">HIDE</span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn color-picker-btn" data-target="back" title="Custom Color">
                                <span class="color-indicator-picker">üé®</span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="back" data-preset="1" data-color="#457B9D" title="Preset Color 1 (Right-click to customize)">
                                <span class="color-indicator preset-1-back" style="background-color: #457B9D;"></span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="back" data-preset="2" data-color="#9E2A2B" title="Preset Color 2 (Right-click to customize)">
                                <span class="color-indicator preset-2-back" style="background-color: #9E2A2B;"></span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="back" data-preset="3" data-color="#4D908E" title="Preset Color 3 (Right-click to customize)">
                                <span class="color-indicator preset-3-back" style="background-color: #4D908E;"></span>
                            </button>
                            <input type="color" class="color-picker-hidden" id="colorPickerBack" data-target="back" value="#000000">
                            <input type="color" class="color-picker-hidden" id="customColorPicker1Back" data-preset="1" data-target="back" value="#457B9D">
                            <input type="color" class="color-picker-hidden" id="customColorPicker2Back" data-preset="2" data-target="back" value="#9E2A2B">
                            <input type="color" class="color-picker-hidden" id="customColorPicker3Back" data-preset="3" data-target="back" value="#4D908E">
                        </div>
                        <div id="editBackText" class="rich-editor" contenteditable="true" placeholder="Enter definition or answer..."></div>
                    </div>
                    <div class="form-group">
                        <label for="editCardFolder">Folder</label>
                        <select id="editCardFolder" class="form-select">
                            <option value="default">Default Folder</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Audio (Optional)</label>
                        <div class="audio-section">
                            <div id="currentAudio" class="current-audio" style="display: none;">
                                <div class="audio-player-container">
                                    <audio id="editAudioPlayer" controls></audio>
                                    <button type="button" class="btn-icon-small btn-danger-small" id="removeAudioBtn" title="Remove Audio">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div id="audioUploadSection" class="audio-upload-section">
                                <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
                                <button type="button" class="btn btn-upload" id="uploadAudioBtn">
                                    <img src="music.png" alt="Upload" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;">
                                    Upload Audio File
                                </button>
                                <small class="input-hint">Supported: MP3, WAV, M4A, OGG (Max 10MB)</small>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelEditBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Test Modal -->
    <div class="modal" id="createTestModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>Add Test</h2>
                <button class="close-btn" id="closeCreateTestBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createTestForm">
                    <div class="form-group">
                        <label for="testFrontText">Front (Question/Prompt)</label>
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn" data-command="bold" data-target="testfront" title="Bold">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="underline" data-target="testfront" title="Underline">
                                <u>U</u>
                            </button>
                            <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertUnorderedList" data-target="testfront" title="Bullet List">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <circle cx="3" cy="5" r="1.5"/>
                                    <rect x="7" y="4" width="10" height="2" rx="1"/>
                                    <circle cx="3" cy="10" r="1.5"/>
                                    <rect x="7" y="9" width="10" height="2" rx="1"/>
                                    <circle cx="3" cy="15" r="1.5"/>
                                    <rect x="7" y="14" width="10" height="2" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertOrderedList" data-target="testfront" title="Numbered List">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <text x="1" y="7" font-size="8" font-weight="bold">1.</text>
                                    <rect x="7" y="4" width="10" height="2" rx="1"/>
                                    <text x="1" y="12" font-size="8" font-weight="bold">2.</text>
                                    <rect x="7" y="9" width="10" height="2" rx="1"/>
                                    <text x="1" y="17" font-size="8" font-weight="bold">3.</text>
                                    <rect x="7" y="14" width="10" height="2" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="toolbar-btn color-btn color-picker-btn" data-target="testfront" title="Custom Color">
                                <span class="color-indicator-picker">üé®</span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="testfront" data-preset="1" data-color="#457B9D" title="Preset Color 1 (Right-click to customize)">
                                <span class="color-indicator preset-1-testfront" style="background-color: #457B9D;"></span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="testfront" data-preset="2" data-color="#9E2A2B" title="Preset Color 2 (Right-click to customize)">
                                <span class="color-indicator preset-2-testfront" style="background-color: #9E2A2B;"></span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="testfront" data-preset="3" data-color="#4D908E" title="Preset Color 3 (Right-click to customize)">
                                <span class="color-indicator preset-3-testfront" style="background-color: #4D908E;"></span>
                            </button>
                            <input type="color" class="color-picker-hidden" id="colorPickerTestFront" data-target="testfront" value="#000000">
                        </div>
                        <div id="testFrontText" class="rich-editor" contenteditable="true" placeholder="Enter test question or prompt..."></div>
                    </div>
                    <div class="form-group">
                        <label for="testBackText">Back (Answer/Solution)</label>
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn" data-command="bold" data-target="testback" title="Bold">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="toolbar-btn" data-command="underline" data-target="testback" title="Underline">
                                <u>U</u>
                            </button>
                            <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertUnorderedList" data-target="testback" title="Bullet List">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <circle cx="3" cy="5" r="1.5"/>
                                    <rect x="7" y="4" width="10" height="2" rx="1"/>
                                    <circle cx="3" cy="10" r="1.5"/>
                                    <rect x="7" y="9" width="10" height="2" rx="1"/>
                                    <circle cx="3" cy="15" r="1.5"/>
                                    <rect x="7" y="14" width="10" height="2" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="toolbar-btn toolbar-btn-list" data-command="insertOrderedList" data-target="testback" title="Numbered List">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <text x="1" y="7" font-size="8" font-weight="bold">1.</text>
                                    <rect x="7" y="4" width="10" height="2" rx="1"/>
                                    <text x="1" y="12" font-size="8" font-weight="bold">2.</text>
                                    <rect x="7" y="9" width="10" height="2" rx="1"/>
                                    <text x="1" y="17" font-size="8" font-weight="bold">3.</text>
                                    <rect x="7" y="14" width="10" height="2" rx="1"/>
                                </svg>
                            </button>
                            <button type="button" class="toolbar-btn color-btn color-picker-btn" data-target="testback" title="Custom Color">
                                <span class="color-indicator-picker">üé®</span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="testback" data-preset="1" data-color="#457B9D" title="Preset Color 1 (Right-click to customize)">
                                <span class="color-indicator preset-1-testback" style="background-color: #457B9D;"></span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="testback" data-preset="2" data-color="#9E2A2B" title="Preset Color 2 (Right-click to customize)">
                                <span class="color-indicator preset-2-testback" style="background-color: #9E2A2B;"></span>
                            </button>
                            <button type="button" class="toolbar-btn color-btn preset-color-btn" data-target="testback" data-preset="3" data-color="#4D908E" title="Preset Color 3 (Right-click to customize)">
                                <span class="color-indicator preset-3-testback" style="background-color: #4D908E;"></span>
                            </button>
                            <input type="color" class="color-picker-hidden" id="colorPickerTestBack" data-target="testback" value="#000000">
                        </div>
                        <div id="testBackText" class="rich-editor" contenteditable="true" placeholder="Enter answer or solution..."></div>
                    </div>
                    <div class="form-group">
                        <label>Audio (Optional)</label>
                        <div class="audio-section">
                            <div id="testCurrentAudio" class="current-audio" style="display: none;">
                                <div class="audio-player-container">
                                    <audio id="testAudioPlayer" controls></audio>
                                    <button type="button" class="btn-icon-small btn-danger-small" id="testRemoveAudioBtn" title="Remove Audio">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                            <div id="testAudioUploadSection" class="audio-upload-section">
                                <input type="file" id="testAudioFileInput" accept="audio/*" style="display: none;">
                                <button type="button" class="btn btn-upload" id="testUploadAudioBtn">
                                    <img src="music.png" alt="Upload" style="width: 14px; height: 14px; vertical-align: middle; margin-right: 4px;">
                                    Upload Audio File
                                </button>
                                <small class="input-hint">Supported: MP3, WAV, M4A, OGG (Max 10MB)</small>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelCreateTestBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add to Test</button>
                    </div>
                </form>
            </div>
        </div>
    </div>


    <!-- Side Selection Modal for Card Flipping -->
    <div class="modal" id="flipSideSelectModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <button class="back-btn" id="backToFlipModeBtn">‚Üê Back</button>
                <h2><img src="cards.png" alt="Cards" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Card Flipping - Choose Starting Side</h2>
                <button class="close-btn" id="closeFlipSideBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="side-selection-options">
                    <div class="side-option-card" id="selectFrontFirst">
                        <div class="side-icon">üìñ</div>
                        <h3>Start with Front</h3>
                        <p>See the question/word first, then flip to see the answer.</p>
                        <button class="btn btn-primary side-select-btn">Select</button>
                    </div>
                    <div class="side-option-card" id="selectBackFirst">
                        <div class="side-icon">üìù</div>
                        <h3>Start with Back</h3>
                        <p>See the answer first, then flip to see the question.</p>
                        <button class="btn btn-primary side-select-btn">Select</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared Folder/List Selection Modal -->
    <div class="modal" id="sharedFolderSelectModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <button class="back-btn" id="backFromSharedFolderBtn">‚Üê Back</button>
                <h2 id="sharedFolderSelectTitle"><img src="books.png" alt="Books" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Choose Folder</h2>
                <button class="close-btn" id="closeSharedFolderBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="folder-selection-options" id="sharedFolderSelectionContainer">
                    <!-- Folders will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Folder Selection Modal for Typing Practice (kept for backward compatibility, redirects to shared) -->
    <div class="modal" id="typingFolderSelectModal" style="display: none;">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <button class="back-btn" id="backFromTypingFolderBtn">‚Üê Back</button>
                <h2><img src="books.png" alt="Books" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Choose Folder</h2>
                <button class="close-btn" id="closeTypingFolderBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="folder-selection-options" id="typingFolderSelectionContainer">
                    <!-- Folders will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Folder Selection Modal for Multiple Choice (kept for backward compatibility, redirects to shared) -->
    <div class="modal" id="multipleChoiceFolderSelectModal" style="display: none;">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <button class="back-btn" id="backToMultipleChoiceModeBtn">‚Üê Back</button>
                <h2><img src="writing.png" alt="Multiple Choice" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Choose Folder</h2>
                <button class="close-btn" id="closeMultipleChoiceFolderBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="folder-selection-options" id="multipleChoiceFolderSelectionContainer">
                    <!-- Folders will be dynamically inserted here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Side Selection Modal for Typing Practice -->
    <div class="modal" id="typingSideSelectModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <button class="back-btn" id="backToTypingModeBtn">‚Üê Back</button>
                <h2><img src="keyboard.png" alt="Keyboard" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Choose Sides</h2>
                <button class="close-btn" id="closeTypingSideBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="typing-side-selection">
                    <div class="side-selection-options">
                        <div class="side-option-card" id="selectSeeFrontTypeBack">
                            <div class="side-icon"><img src="pencil.png" alt="Pencil" style="width: 60px; height: 60px;"></div>
                            <h3>See Front, Type Back</h3>
                            <p>See the question/word, then type the answer.</p>
                            <button class="btn btn-primary side-select-btn">Select</button>
                        </div>
                        <div class="side-option-card" id="selectSeeBackTypeFront">
                            <div class="side-icon"><img src="pencil.png" alt="Pencil" style="width: 60px; height: 60px;"></div>
                            <h3>See Back, Type Front</h3>
                            <p>See the answer, then type the question/word.</p>
                            <button class="btn btn-primary side-select-btn">Select</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Selection Modal for Flipping -->
    <div class="modal" id="categorySelectModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <button class="back-btn" id="backToCategoryBtn">‚Üê Back</button>
                <h2>Choose Category</h2>
                <button class="close-btn" id="closeCategorySelectBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="test-mode-options">
                    <div class="test-mode-card" id="selectCardsCategory">
                        <div class="mode-icon"><img src="cards.png" alt="Cards" style="width: 60px; height: 60px;"></div>
                        <h3>Cards</h3>
                        <p>Flip through your vocabulary cards.</p>
                        <button class="btn btn-primary mode-select-btn">Select</button>
                    </div>
                    <div class="test-mode-card" id="selectTestsCategory">
                        <div class="mode-icon"><img src="writing.png" alt="Tests" style="width: 60px; height: 60px;"></div>
                        <h3>Tests</h3>
                        <p>Flip through your test cards.</p>
                        <button class="btn btn-create mode-select-btn">Select</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content modal-small">
            <div class="modal-header delete-header">
                <div class="delete-icon-large">üóëÔ∏è</div>
                <h2>Delete Card?</h2>
            </div>
            <div class="modal-body">
                <p class="confirm-text">Are you sure you want to delete this card? This action cannot be undone.</p>
                <div class="form-actions confirm-actions">
                    <button type="button" class="btn btn-secondary" id="cancelDeleteBtn">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Sign In Modal -->
    <div class="modal" id="signInModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üîê Sign In</h2>
                <button class="close-btn" id="closeSignInBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="signInForm">
                    <div class="form-group">
                        <label for="signInContact">Email or Phone Number</label>
                        <input type="text" id="signInContact" placeholder="Enter your email or phone number" required>
                        <small class="input-hint">Enter the email or phone number you used when signing up</small>
                    </div>
                    <div class="form-group">
                        <label for="signInPassword">Password</label>
                        <input type="password" id="signInPassword" placeholder="Enter your password" required>
                    </div>
                    <div id="signInError" class="error-message" style="display: none;"></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelSignInBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Sign In</button>
                    </div>
                </form>
                <p class="auth-switch">
                    <a href="#" id="forgotPasswordLink">Forgot Password?</a> | 
                    Don't have an account? <a href="#" id="switchToSignUp">Sign Up</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div class="modal" id="signUpModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üìù Sign Up</h2>
                <button class="close-btn" id="closeSignUpBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="signUpForm">
                    <div class="form-group">
                        <label for="signUpUsername">Username</label>
                        <input type="text" id="signUpUsername" placeholder="Choose a username" required minlength="3">
                        <small class="input-hint">At least 3 characters</small>
                    </div>
                    <div class="form-group">
                        <label for="signUpContact">Email or Phone Number</label>
                        <input type="text" id="signUpContact" placeholder="your@email.com or +1234567890" required>
                        <small class="input-hint">Required for password recovery</small>
                    </div>
                    <div class="form-group">
                        <label for="signUpPassword">Password</label>
                        <input type="password" id="signUpPassword" placeholder="Choose a strong password" required minlength="8">
                        <small class="input-hint">At least 8 characters with uppercase, lowercase, and number</small>
                    </div>
                    <div class="form-group">
                        <label for="signUpPasswordConfirm">Confirm Password</label>
                        <input type="password" id="signUpPasswordConfirm" placeholder="Confirm your password" required>
                    </div>
                    <div id="signUpError" class="error-message" style="display: none;"></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelSignUpBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Sign Up</button>
                    </div>
                </form>
                <p class="auth-switch">Already have an account? <a href="#" id="switchToSignIn">Sign In</a></p>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal" id="forgotPasswordModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üîë Account Recovery</h2>
                <button class="close-btn" id="closeForgotPasswordBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="forgotPasswordForm">
                    <div class="form-group">
                        <label for="forgotContact">Email or Phone Number</label>
                        <input type="text" id="forgotContact" placeholder="Enter your email or phone number" required>
                        <small class="input-hint">Enter the email or phone number you used when signing up</small>
                    </div>
                    <div id="forgotPasswordError" class="error-message" style="display: none;"></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelForgotPasswordBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Send Recovery Code</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Verify Code Modal -->
    <div class="modal" id="verifyCodeModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>‚úâÔ∏è Account Recovery</h2>
                <button class="close-btn" id="closeVerifyCodeBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="info-message" id="codeInfo" style="margin-bottom: 20px;">
                    <p style="margin: 0; line-height: 1.6;">A recovery code has been sent to: <strong id="maskedContact"></strong></p>
                    <p style="margin: 10px 0 0 0; font-size: 0.9rem; color: #666;">
                        <em>(Demo Mode: Your code is <strong style="color: #5FB3A7;" id="displayCode"></strong>)</em>
                    </p>
                </div>
                <form id="verifyCodeForm">
                    <div class="form-group">
                        <label for="verificationCode">Enter Code</label>
                        <input type="text" id="verificationCode" placeholder="Enter 6-digit code" required maxlength="6" pattern="[0-9]{6}">
                        <small class="input-hint">Enter the 6-digit code</small>
                    </div>
                    <div class="form-group">
                        <label for="recoveredUsername">Your Username</label>
                        <input type="text" id="recoveredUsername" readonly style="background-color: #f8f9fa; color: #666;">
                        <small class="input-hint">This is your current username</small>
                    </div>
                    <div class="form-group">
                        <label for="newUsername">New Username (Optional)</label>
                        <input type="text" id="newUsername" placeholder="Enter new username (leave blank to keep current)">
                        <small class="input-hint">At least 3 characters</small>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" placeholder="Enter new password" required minlength="8">
                        <small class="input-hint">At least 8 characters with uppercase, lowercase, and number</small>
                    </div>
                    <div class="form-group">
                        <label for="newPasswordConfirm">Confirm New Password</label>
                        <input type="password" id="newPasswordConfirm" placeholder="Confirm new password" required>
                    </div>
                    <div id="verifyCodeError" class="error-message" style="display: none;"></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelVerifyCodeBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Account</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Special Access Activation Modal -->
    <div class="modal" id="specialAccessModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Special Access Activation</h2>
                <button class="close-btn" id="closeSpecialAccessBtn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="specialAccessForm">
                    <div class="form-group">
                        <label for="activationCode">Activation Code</label>
                        <input type="text" id="activationCode" placeholder="Enter activation code" required>
                        <small class="input-hint">Whitelisted users enjoy unlimited cards and unlimited folders.</small>
                    </div>
                    <div id="specialAccessError" class="error-message" style="display: none;"></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelSpecialAccessBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Activate</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Premium Activation Modal -->
    <div class="modal" id="premiumModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Unlock Premium</h2>
                <button class="close-btn" id="closePremiumModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-lede">
                    Enter your activation code to enable unlimited cards & folders, Multiple Choice practice, exports, and every Premium tool.
                </p>
                <form id="premiumCodeForm">
                    <div class="form-group">
                        <label for="premiumCodeInput">Activation Code</label>
                        <input type="text" id="premiumCodeInput" placeholder="VBX-PREM-12345" autocomplete="off" required>
                        <small class="input-hint">Codes are single-use. Already used codes cannot be redeemed again.</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelPremiumModalBtn">Cancel</button>
                        <button type="submit" class="btn btn-primary">Activate Premium</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Custom Color Picker Modal -->
    <div class="modal" id="customColorPickerModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üé® Choose Custom Color</h2>
                <button class="close-btn" id="closeCustomColorPickerBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <p style="margin: 0 0 15px 0; color: #666; line-height: 1.6;">
                        Select any color to apply to your text.
                    </p>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333; text-align: center;">
                            Select Color:
                        </label>
                        <input type="color" id="customColorPickerInput" style="width: 100%; height: 60px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; margin-bottom: 15px;">
                        
                        <div style="text-align: center; margin: 10px 0; color: #999; font-size: 0.9rem;">or</div>
                        
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 0.9rem;">
                            Paste Hex Code:
                        </label>
                        <input type="text" id="customColorPickerHexInput" placeholder="#457B9D or 457B9D" 
                            style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; font-size: 1rem; text-align: center; text-transform: uppercase;">
                        <small style="display: block; margin-top: 5px; color: #999; font-size: 0.8rem; text-align: center;">
                            Enter with or without #
                        </small>
                    </div>
                    <div style="margin-top: 20px; background: #fff; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px;">
                        <p style="margin: 0 0 10px 0; font-weight: 600; color: #333; font-size: 0.9rem;">Preview:</p>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div id="customColorPickerPreviewBox" style="width: 50px; height: 50px; border-radius: 8px; border: 2px solid #ddd; flex-shrink: 0;"></div>
                            <div>
                                <p style="margin: 0; font-size: 0.85rem; color: #666;">Sample text in <span id="customColorPickerPreviewText" style="font-weight: bold;">this color</span></p>
                                <p id="customColorPickerHexDisplay" style="margin: 5px 0 0 0; font-size: 0.75rem; color: #999; font-family: monospace;"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelCustomColorPickerBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmCustomColorPickerBtn">‚úì Confirm Color</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Color Customization Modal -->
    <div class="modal" id="colorCustomizationModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üé® Customize Preset Color <span id="customColorPresetNum"></span></h2>
                <button class="close-btn" id="closeColorCustomBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <p style="margin: 0 0 15px 0; color: #666; line-height: 1.6;">
                        Choose a new color for this preset button. This will update the color across all cards.
                    </p>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600; color: #333; text-align: center;">
                            Select Color:
                        </label>
                        <input type="color" id="customColorInput" style="width: 100%; height: 60px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; margin-bottom: 15px;">
                        
                        <div style="text-align: center; margin: 10px 0; color: #999; font-size: 0.9rem;">or</div>
                        
                        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333; font-size: 0.9rem;">
                            Paste Hex Code:
                        </label>
                        <input type="text" id="customColorHexInput" placeholder="#457B9D or 457B9D" 
                            style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-family: monospace; font-size: 1rem; text-align: center; text-transform: uppercase;">
                        <small style="display: block; margin-top: 5px; color: #999; font-size: 0.8rem; text-align: center;">
                            Enter with or without #
                        </small>
                    </div>
                    <div style="margin-top: 20px; background: #fff; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px;">
                        <p style="margin: 0 0 10px 0; font-weight: 600; color: #333; font-size: 0.9rem;">Preview:</p>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div id="colorPreviewBox" style="width: 50px; height: 50px; border-radius: 8px; border: 2px solid #ddd; flex-shrink: 0;"></div>
                            <div>
                                <p style="margin: 0; font-size: 0.85rem; color: #666;">Sample text in <span id="colorPreviewText" style="font-weight: bold;">this color</span></p>
                                <p id="colorHexDisplay" style="margin: 5px 0 0 0; font-size: 0.75rem; color: #999; font-family: monospace;"></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelColorCustomBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirmColorCustomBtn">‚úì Confirm Color</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Word List Modal -->
    <div class="modal" id="importWordListModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2><img src="cards.png" alt="Import" style="width: 24px; height: 24px; vertical-align: middle; margin-right: 8px;"> Import Word List</h2>
                <button class="close-btn" id="closeImportModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="simple-import-section">
                    <div class="import-divider">
                        <span class="import-instruction">Import IELTS vocabulary or paste your word list</span>
                    </div>
                    
                    <!-- File Upload Section -->
                    <div class="file-upload-section">
                        <div class="form-group">
                            <label for="vocabularyFileInput">Upload IELTS Vocabulary File (.txt)</label>
                            <input type="file" id="vocabularyFileInput" accept=".txt" style="display: none;">
                            <button type="button" class="btn btn-secondary btn-small" id="selectFileBtn">
                                <img src="books.png" alt="File" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 8px;">
                                Apply IELTS 8000
                            </button>
                            <div id="selectedFileName" class="selected-file-name" style="display: none;"></div>
                        </div>
                    </div>
                    
                    <div class="import-divider">
                        <span class="import-instruction">Or paste your word list here</span>
                    </div>
                    
                    <div class="form-group">
                        <textarea id="bulkTextInput" class="word-list-textarea" placeholder="Word 1 Definition 1&#10;Word 2 Definition 2&#10;Word 3 Definition 3"></textarea>
                    </div>
                    
                    <div class="delimiter-options">
                        <div class="delimiter-section">
                            <label class="delimiter-label">Target Folder:</label>
                            <div class="form-group folder-selector-group">
                                <select id="importFolderSelect" class="form-select">
                                    <option value="default">Default Folder</option>
                                </select>
                                <button type="button" class="btn btn-secondary btn-small" id="createFolderForImportBtn">
                                    <img src="plus.png" alt="Add" style="width: 12px; height: 12px; vertical-align: middle; margin-right: 4px;">
                                    Folder
                                </button>
                            </div>
                        </div>
                        <div class="delimiter-section" id="importListGroup" style="display: none;">
                            <label class="delimiter-label">List (Optional):</label>
                            <div class="form-group folder-selector-group">
                                <select id="importListSelect" class="form-select">
                                    <option value="">No List (Save to Folder)</option>
                                </select>
                                <button type="button" class="btn btn-secondary btn-small" id="createListForImportBtn">
                                    <img src="plus.png" alt="Add" style="width: 12px; height: 12px; vertical-align: middle; margin-right: 4px;">
                                    List
                                </button>
                            </div>
                        </div>
                        
                        <div class="delimiter-section">
                            <label class="delimiter-label">Between Term and Definition:</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="termDefDelimiter" value="space" checked>
                                    <span class="radio-text">Space</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="termDefDelimiter" value="comma">
                                    <span class="radio-text">Comma</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="termDefDelimiter" value="dash">
                                    <span class="radio-text">Dash</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="termDefDelimiter" value="custom">
                                    <span class="radio-text">Custom</span>
                                    <input type="text" id="customTermDefDelim" class="custom-delimiter" placeholder="Enter custom delimiter">
                                </label>
                            </div>
                        </div>
                        
                        <div class="delimiter-section">
                            <label class="delimiter-label">Between cards:</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="cardDelimiter" value="newline" checked>
                                    <span class="radio-text">New Line</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="cardDelimiter" value="semicolon">
                                    <span class="radio-text">Semicolon</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="cardDelimiter" value="custom">
                                    <span class="radio-text">Custom</span>
                                    <input type="text" id="customCardDelim" class="custom-delimiter" placeholder="Enter custom delimiter">
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="preview-section">
                        <div class="preview-header">Preview <span id="importPreviewCount">0</span> cards</div>
                        <div id="previewCardsContainer" class="preview-cards-container">
                            <div class="preview-placeholder">Nothing to preview yet.</div>
                        </div>
                    </div>
                </div>
                
                <div id="importError" class="error-message" style="display: none;"></div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="cancelImportBtn">Cancel</button>
                    <button type="button" class="btn btn-primary" id="importCardsBtn">Import Cards</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Typing Mode Screen -->
    <div class="test-mode-screen" id="typingModeScreen">
        <div class="test-container">
            <div class="test-header">
                <h2><img src="keyboard.png" alt="Keyboard" class="session-mode-icon" style="width: 28px; height: 28px; vertical-align: middle; margin-right: 8px;"> Typing Practice Mode</h2>
                <button class="btn btn-secondary" id="exitTypingBtn">Exit Test</button>
            </div>
            <div class="test-progress">
                <p>Question <span id="typingCardNum">1</span> of <span id="typingTotalCards">0</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="typingProgressFill"></div>
                </div>
            </div>
            <div class="typing-card">
                <button class="card-arrow card-arrow-left" id="typingCardArrowLeft" aria-label="Previous card">‚Üê</button>
                <div class="typing-question">
                    <h3>Question:</h3>
                    <div class="question-content" id="typingQuestion"></div>
                </div>
                <div class="typing-answer-section">
                    <textarea id="typingAnswer" class="typing-textarea" placeholder="Type your answer here..."></textarea>
                    <div class="typing-mode-toggle-container" style="text-align: center; margin: 12px 0;">
                        <button class="btn btn-secondary btn-small" id="typingModeToggleBtn" type="button" style="font-size: 0.9rem; padding: 8px 16px;">
                            Type Front Side
                        </button>
                    </div>
                    <button class="btn btn-primary" id="checkAnswerBtn">Check Answer</button>
                </div>
                <div class="answer-result" id="answerResult" style="display: none;">
                    <div class="result-header">
                        <h3 id="resultTitle"></h3>
                    </div>
                    <div id="correctAnswerContent"></div>
                </div>
                <button class="card-arrow card-arrow-right" id="typingCardArrowRight" aria-label="Next card">‚Üí</button>
            </div>
            <div class="audio-replay-section" id="typingAudioReplay" style="display: none;">
                <button class="btn btn-audio-replay" id="replayTypingAudioBtn">
                    <img src="music.png" alt="Replay Audio" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"> Replay Audio
                </button>
            </div>
            <div class="finish-test-section" style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" id="finishTestBtn" style="font-size: 1.1rem; padding: 12px 30px; background: #F4D58D; color: #333;">
                    ‚úì Finish Test & See Results
                </button>
            </div>
        </div>
    </div>

    <!-- Multiple Choice Mode Screen -->
    <div class="test-mode-screen" id="multipleChoiceModeScreen">
        <div class="test-container">
            <div class="test-header">
                <h2><img src="writing.png" alt="Multiple Choice" class="session-mode-icon" style="width: 28px; height: 28px; vertical-align: middle; margin-right: 8px;"> Multiple Choice Mode</h2>
                <button class="btn btn-secondary" id="exitMultipleChoiceBtn">Exit Test</button>
            </div>
            <div class="test-progress">
                <p>Question <span id="mcCardNum">1</span> of <span id="mcTotalCards">0</span></p>
                <div class="progress-bar">
                    <div class="progress-fill" id="mcProgressFill"></div>
                </div>
            </div>
            <div class="typing-card">
                <button class="card-arrow card-arrow-left" id="mcCardArrowLeft" aria-label="Previous card">‚Üê</button>
                <div class="typing-question">
                    <h3>Question:</h3>
                    <div class="question-content" id="mcQuestion"></div>
                </div>
                <div class="mc-mode-toggle-container" style="text-align: center; margin: 12px 0;">
                    <button class="btn btn-secondary btn-small" id="mcModeToggleBtn" type="button" style="font-size: 0.9rem; padding: 8px 16px;">
                        Answer Front Side
                    </button>
                </div>
                <div class="multiple-choice-options" id="multipleChoiceOptions">
                    <!-- Options will be dynamically inserted here -->
                </div>
                <button class="card-arrow card-arrow-right" id="mcCardArrowRight" aria-label="Next card">‚Üí</button>
            </div>
            <div class="audio-replay-section" id="mcAudioReplay" style="display: none;">
                <button class="btn btn-audio-replay" id="replayMcAudioBtn">
                    <img src="music.png" alt="Replay Audio" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"> Replay Audio
                </button>
            </div>
            <div class="finish-test-section" style="text-align: center; margin-top: 20px;">
                <button class="btn btn-success" id="finishMcTestBtn" style="font-size: 1.1rem; padding: 12px 30px; background: #F4D58D; color: #333;">
                    ‚úì Finish Test & See Results
                </button>
            </div>
        </div>
    </div>

    <!-- Test Results Modal -->
    <div class="modal" id="testResultsModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>Test Results</h2>
                <button class="close-btn" id="closeResultsBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="results-summary">
                    <div class="grade-circle">
                        <div class="grade-percentage" id="gradePercentage">0%</div>
                        <div class="grade-label">Your Score</div>
                    </div>
                    
                    <div class="results-stats">
                        <div class="stat-item stat-total">
                            <div class="stat-info">
                                <div class="stat-number" id="totalQuestions">0</div>
                                <div class="stat-label">Total Questions</div>
                            </div>
                        </div>
                        <div class="stat-item stat-correct">
                            <div class="stat-info">
                                <div class="stat-number" id="correctAnswers">0</div>
                                <div class="stat-label">Correct Answers</div>
                            </div>
                        </div>
                        <div class="stat-item stat-incorrect">
                            <div class="stat-info">
                                <div class="stat-number" id="incorrectAnswers">0</div>
                                <div class="stat-label">Incorrect Answers</div>
                            </div>
                        </div>
                        <div class="stat-item stat-unanswered">
                            <div class="stat-info">
                                <div class="stat-number" id="unansweredAnswers">0</div>
                                <div class="stat-label">Unanswered</div>
                            </div>
                        </div>
                    </div>

                    <div class="performance-message" id="performanceMessage">
                        <p></p>
                    </div>

                    <!-- Incorrect Answers List -->
                    <div class="answers-review-section" id="answersReviewSection" style="display: none;">
                        <div class="answers-review-container">
                            <!-- Incorrect Answers -->
                            <div class="incorrect-answers-section" id="incorrectAnswersSection" style="display: none;">
                                <h3 class="review-section-title incorrect-title">‚ùå Incorrect Answers</h3>
                                <div class="review-answers-list" id="incorrectAnswersList"></div>
                            </div>
                        </div>
                    </div>

                    <div class="results-actions">
                        <button class="btn btn-primary" id="retakeTestBtn">Retake Test</button>
                        <button class="btn btn-create" id="exitToHomeBtn">Back to Home</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- App Notifications (Modal + Toast) -->
    <div id="appToastContainer" class="toast-container"></div>

    <div id="appConfirmModal" class="vb-modal" aria-hidden="true">
      <div class="vb-modal__backdrop" data-close="true"></div>
      <div class="vb-modal__card" role="dialog" aria-modal="true" aria-labelledby="vbConfirmTitle">
        <button class="vb-modal__close" data-close="true" aria-label="Close">√ó</button>
        <div class="vb-modal__header">
          <div class="vb-modal__icon"><img src="trashbin.png" alt="Delete" style="width: 100%; height: 100%; object-fit: contain;"></div>
          <h3 id="vbConfirmTitle" class="vb-modal__title">Confirm</h3>
          <p id="vbConfirmDesc" class="vb-modal__desc">Are you sure?</p>
        </div>
        <div class="vb-modal__actions">
          <button id="vbCancelBtn" class="btn btn-ghost">Cancel</button>
          <button id="vbConfirmBtn" class="btn btn-primary">Confirm</button>
        </div>
      </div>
    </div>

    <!-- Upgrade/Subscription Modal -->
    <div class="modal" id="upgradeModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2>Upgrade to Premium</h2>
                <button class="close-btn" id="closeUpgradeBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="upgradeLimitMessage" style="margin-bottom: 20px;">
                    <div class="info-message" style="background: #fff3cd; border-color: #ffc107;">
                        <p><strong>You've reached your free tier limit!</strong></p>
                        <p id="upgradeLimitText">Upgrade to Premium to unlock unlimited cards and folders.</p>
                    </div>
                </div>
                
                <div class="subscription-plans" style="display: grid; gap: 20px; margin-bottom: 20px;">
                    <!-- Premium Plan -->
                    <div class="plan-card" style="border: 2px solid #4CAF50; border-radius: 12px; padding: 20px; background: #f8fff9;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h3 style="margin: 0 0 5px 0; color: #4CAF50;">Premium</h3>
                                <p style="margin: 0; color: #666; font-size: 0.9rem;">Best for serious learners</p>
                            </div>
                            <span class="plan-badge" style="background: #4CAF50; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: bold;">POPULAR</span>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #333;">
                                $<span id="premiumMonthlyPrice">4.99</span>
                                <span style="font-size: 1rem; font-weight: normal; color: #666;">/month</span>
                            </div>
                            <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                                or $<span id="premiumYearlyPrice">39.99</span>/year (save 33%)
                            </div>
                        </div>
                        <ul style="list-style: none; padding: 0; margin: 0 0 20px 0;">
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #4CAF50; font-weight: bold;">‚úì</span>
                                <span>Unlimited cards</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #4CAF50; font-weight: bold;">‚úì</span>
                                <span>Unlimited folders</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #4CAF50; font-weight: bold;">‚úì</span>
                                <span>Advanced statistics</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #4CAF50; font-weight: bold;">‚úì</span>
                                <span>Spaced repetition</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #4CAF50; font-weight: bold;">‚úì</span>
                                <span>Audio pronunciation</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #4CAF50; font-weight: bold;">‚úì</span>
                                <span>PDF export</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #4CAF50; font-weight: bold;">‚úì</span>
                                <span>Priority support</span>
                            </li>
                        </ul>
                        <button class="btn btn-primary" id="upgradeToPremiumBtn" style="width: 100%; padding: 12px; font-size: 1.1rem;">
                            Upgrade to Premium
                        </button>
                    </div>

                    <!-- Pro Plan -->
                    <div class="plan-card" style="border: 2px solid #9C27B0; border-radius: 12px; padding: 20px; background: #faf5ff;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h3 style="margin: 0 0 5px 0; color: #9C27B0;">Pro</h3>
                                <p style="margin: 0; color: #666; font-size: 0.9rem;">For power users</p>
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 2rem; font-weight: bold; color: #333;">
                                $<span id="proMonthlyPrice">9.99</span>
                                <span style="font-size: 1rem; font-weight: normal; color: #666;">/month</span>
                            </div>
                            <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">
                                or $<span id="proYearlyPrice">79.99</span>/year (save 33%)
                            </div>
                        </div>
                        <ul style="list-style: none; padding: 0; margin: 0 0 20px 0;">
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #9C27B0; font-weight: bold;">‚úì</span>
                                <span>Everything in Premium</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #9C27B0; font-weight: bold;">‚úì</span>
                                <span>AI-powered card generation</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #9C27B0; font-weight: bold;">‚úì</span>
                                <span>Collaborative decks</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #9C27B0; font-weight: bold;">‚úì</span>
                                <span>Advanced analytics dashboard</span>
                            </li>
                            <li style="padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                                <span style="color: #9C27B0; font-weight: bold;">‚úì</span>
                                <span>API access</span>
                            </li>
                        </ul>
                        <button class="btn btn-secondary" id="upgradeToProBtn" style="width: 100%; padding: 12px; font-size: 1.1rem; background: #9C27B0; border-color: #9C27B0;">
                            Upgrade to Pro
                        </button>
                    </div>
                </div>

                <div style="text-align: center; padding-top: 20px; border-top: 1px solid #eee;">
                    <p style="color: #666; font-size: 0.9rem; margin: 0;">
                        üí≥ Secure payment via Stripe ‚Ä¢ Cancel anytime ‚Ä¢ 30-day money-back guarantee
                    </p>
                </div>

                <!-- Special Access Section -->
                <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee;">
                    <h3 style="margin: 0 0 15px 0; color: #333; font-size: 1.1rem;">Special Access</h3>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                        Have an activation code? Enter it below to unlock unlimited access.
                    </p>
                    <button class="btn special-access-btn-modal" id="specialAccessBtn" style="width: 100%; padding: 12px; font-size: 1rem;">
                        Activate Special Access
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export/Import Data Modal -->
    <div class="modal" id="exportImportModal">
        <div class="modal-content modal-medium">
            <div class="modal-header">
                <h2 id="exportImportModalTitle">Export/Import Data</h2>
                <button class="close-btn" id="closeExportImportBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="exportSection" style="display: none;">
                    <div class="info-message" style="margin-bottom: 20px;">
                        <p>Export all your data including cards, folders, and settings. This creates a backup file that you can import later or use on another device.</p>
                    </div>
                    <div class="form-group">
                        <label>Export Options:</label>
                        <div style="margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="exportCards" checked style="width: auto;">
                                <span id="exportCardsLabel">Cards</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="exportFolders" checked style="width: auto;">
                                <span id="exportFoldersLabel">Folders</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="checkbox" id="exportSettings" checked style="width: auto;">
                                <span>Settings (custom colors, preferences)</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelExportBtn">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirmExportBtn">üíæ Download Export File</button>
                    </div>
                </div>
                <div id="importSection" style="display: none;">
                    <div class="info-message" style="margin-bottom: 20px;">
                        <p><strong>Warning:</strong> Importing data will replace your current data. Make sure to export your current data first as a backup.</p>
                    </div>
                    <div class="form-group">
                        <label for="importFileInput">Select Export File:</label>
                        <input type="file" id="importFileInput" accept=".json" style="display: none;">
                        <button type="button" class="btn btn-secondary" id="selectImportFileBtn" style="width: 100%; margin-top: 10px;">
                            üìÅ Choose File
                        </button>
                        <div id="selectedFileName" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; display: none;">
                            <strong>Selected:</strong> <span id="fileNameDisplay"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Import Options:</label>
                        <div style="margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="radio" name="importMode" value="replace" checked style="width: auto;">
                                <span>Replace all data (recommended for first import)</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <input type="radio" name="importMode" value="merge" style="width: auto;">
                                <span>Merge with existing data (may create duplicates)</span>
                            </label>
                        </div>
                    </div>
                    <div id="importError" class="error-message" style="display: none;"></div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancelImportDataBtn">Cancel</button>
                        <button type="button" class="btn btn-primary" id="confirmImportBtn" disabled>üì• Import Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration -->
    <script src="config.js"></script>
    <script src="category-config.js"></script>
    <script src="data/premium-codes.js"></script>
    <script src="word-pack-map.js"></script>
    <script src="sentence-pack-map.js"></script>
    <script src="grammar-pack-map.js"></script>
    <script src="listening-pack-map.js"></script>
    <script src="reading-pack-map.js"></script>
    
    <!-- Add new pack maps -->
    <script src="word-pack-map.js"></script>
    <script src="sentence-pack-map.js"></script>
    <script src="grammar-pack-map.js"></script>
    <script src="listening-pack-map.js"></script>

    <!-- Supabase Client (loaded only if configured) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Main Application Script -->
    <script src="script.js"></script>

    <!-- Footer with ICP and ÂÖ¨ÂÆâÂ§áÊ°à (Add your numbers after completing filings) -->
    <footer style="text-align: center; padding: 20px; color: #666; font-size: 0.85rem; border-top: 1px solid #eee; margin-top: 40px; background: #f8f9fa;">
        <p style="margin: 5px 0;">¬© 2024 VocaBox. All rights reserved.</p>
        <p style="margin: 5px 0;">
            <!-- Replace [ICP_NUMBER] with your actual ICPÂ§áÊ°àÂè∑ after approval -->
            <a href="https://beian.miit.gov.cn" target="_blank" style="color: #666; text-decoration: none;">
                ICPÂ§áÊ°àÂè∑: [ICP_NUMBER]
            </a>
            <span style="margin: 0 10px;">|</span>
            <!-- Replace [PSB_NUMBER] with your actual ÂÖ¨ÂÆâÂ§áÊ°àÂè∑ after approval -->
            <a href="http://www.beian.gov.cn" target="_blank" style="color: #666; text-decoration: none;">
                ÂÖ¨ÂÆâÂ§áÊ°àÂè∑: [PSB_NUMBER]
            </a>
        </p>
    </footer>
</body>
</html>

